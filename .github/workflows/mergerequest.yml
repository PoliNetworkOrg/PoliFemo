name: Comment on PR with ClickUp task
on:
    pull_request:
        types: [opened, reopened]

jobs:
    comment:
        name: Comment on PR with ClickUp task
        runs-on: ubuntu-20.04
        steps:
            - uses: actions/github-script@v6
              id: my-script
              with:
                  result-encoding: string
                  retries: 3
                  script: |
                      const branch_name = context.payload.pull_request.head.ref;
                      if (!branch_name) return;
                      const matches = branch_name.match(/feature\/CU-([a-z0-9]+)/i) 
                      if (!matches) return;
                      const taskID = matches[1]
                      if (!taskID) return;
                      github.rest.issues.createComment({
                        issue_number: context.issue.number,
                        owner: context.repo.owner,
                        repo: context.repo.repo,
                        body: `task: CU-${taskID}`
                      })
